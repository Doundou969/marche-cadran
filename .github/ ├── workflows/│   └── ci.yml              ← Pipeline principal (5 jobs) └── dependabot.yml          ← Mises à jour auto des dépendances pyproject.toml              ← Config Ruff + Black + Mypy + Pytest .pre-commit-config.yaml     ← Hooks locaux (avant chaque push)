# âœ… CI Checklist â€” FastAPI Python Project
**Stack :** GitHub Actions Â· Python 3.11 / 3.12 Â· pip Â· Mypy Â· Ruff Â· Black Â· Pytest

---

## ğŸ“ Fichiers Ã  ajouter dans le repo

```
.github/
â”œâ”€â”€ workflows/
â”‚   â””â”€â”€ ci.yml              â† Pipeline principal (5 jobs)
â””â”€â”€ dependabot.yml          â† Mises Ã  jour auto des dÃ©pendances
pyproject.toml              â† Config Ruff + Black + Mypy + Pytest
.pre-commit-config.yaml     â† Hooks locaux (avant chaque push)
```

---

## ğŸ”² Checklist d'installation (Ã  faire une seule fois)

### 1. Installer les outils de dev localement
```bash
pip install ruff black mypy bandit pip-audit pytest pytest-cov pre-commit
```

### 2. Activer les pre-commit hooks
```bash
pre-commit install
pre-commit run --all-files   # VÃ©rification initiale sur tout le code
```

### 3. CrÃ©er requirements-dev.txt (si non existant)
```
pytest
pytest-cov
pytest-asyncio
httpx          # Pour tester les routes FastAPI
ruff
black
mypy
bandit
pip-audit
pre-commit
```

### 4. VÃ©rifier que le Dockerfile existe
Le job `build` dans `ci.yml` requiert un `Dockerfile` Ã  la racine
et un endpoint `/health` dans votre API FastAPI.

### 5. Activer Dependabot sur GitHub
Settings â†’ Security â†’ Code security â†’ Dependabot alerts â†’ Enable

---

## âš™ï¸ Jobs CI dans l'ordre d'exÃ©cution

| # | Job | Outil | Bloquant |
|---|-----|-------|----------|
| 1 | **Lint & Format** | Ruff + Black | âœ… Oui |
| 2 | **Type Check** | Mypy | âœ… Oui |
| 3 | **Tests** (matrix 3.11 + 3.12) | Pytest + Coverage â‰¥ 80% | âœ… Oui |
| 4 | **Security Scan** | Bandit + pip-audit | âœ… Oui |
| 5 | **Docker Build** | docker build + smoke test | âœ… Oui (aprÃ¨s 1-2-3) |

---

## ğŸ§ª Conventions de tests FastAPI

```python
# tests/test_main.py
from httpx import AsyncClient
from app.main import app
import pytest

@pytest.mark.asyncio
async def test_health():
    async with AsyncClient(app=app, base_url="http://test") as client:
        response = await client.get("/health")
    assert response.status_code == 200
```

---

## ğŸ” Secrets GitHub Ã  configurer

Settings â†’ Secrets and variables â†’ Actions :

| Secret | Usage |
|--------|-------|
| `CODECOV_TOKEN` | Upload du rapport de coverage (optionnel) |

---

## ğŸ“ˆ Ã‰tapes suivantes recommandÃ©es

- [ ] Ajouter un job **CD** (dÃ©ploiement) dÃ©clenchÃ© sur `push main` uniquement
- [ ] Configurer **branch protection rules** (PR obligatoire + CI verte)
- [ ] Ajouter **pytest-xdist** pour parallÃ©liser les tests
- [ ] IntÃ©grer **Sentry SDK** pour le monitoring en production
